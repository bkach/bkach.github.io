<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Diesel Calculator | The van build</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Diesel Calculator" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The site for the bridgeborbarnvsky vanbuild. WIP - check back for updates" />
<meta property="og:description" content="The site for the bridgeborbarnvsky vanbuild. WIP - check back for updates" />
<link rel="canonical" href="/diesel-calculator/" />
<meta property="og:url" content="/diesel-calculator/" />
<meta property="og:site_name" content="The van build" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Diesel Calculator" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"The site for the bridgeborbarnvsky vanbuild. WIP - check back for updates","headline":"Diesel Calculator","url":"/diesel-calculator/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="The van build" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">The van build</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/diesel-calculator/">Diesel Calculator</a><a class="page-link" href="/electrics/">Electrics</a><a class="page-link" href="/how-to/">How to</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Diesel Calculator</h1>
  </header>

  <div class="post-content">
    <!DOCTYPE html>
<html>
<head>
    <script src="../jquery-3.6.0.min.js"></script>
    <script src="../jquery.csv.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <script>
        $(document).ready(function () {
            let milesInput = $("#distance-input");
            milesInput.change(docalc);

            let mpl = 7.424;

            const Http = new XMLHttpRequest();
            const url = "https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/1068229/CSV-11apr2022.csv";
            Http.open("GET", url);
            Http.send();

            let pricePerLiter = 0
            let dates = []
            let chartData = []

            var result
            Http.onreadystatechange = (e) => {
                if (Http.readyState === XMLHttpRequest.DONE) {
                    result = $.csv.toArrays(Http.responseText);
                    result.reverse();

                    result.forEach((r, i) => {
                        var parts = r[0].split("/");
                        var dt = new Date(parseInt(parts[2], 10),
                            parseInt(parts[1], 10) - 1,
                            parseInt(parts[0], 10));
                        let date = dt.toLocaleDateString('en-us', {
                            day: 'numeric'
                        })
                        let month = dt.toLocaleDateString('en-us', {
                            month: 'long'
                        })
                        let year = dt.toLocaleDateString('en-us', {
                            year: 'numeric'
                        })
                        if (date !== "Invalid Date") {
                            dates.push(result[i][0])
                            chartData.push({
                                date: Date.parse(`${date} ${month} ${year}`),
                                price: result[i][2]
                            })
                        }
                    })

                    LineChart(chartData, {
                        x: d => d.date,
                        y: d => d.price,
                        width: 1000,
                        height: 1000,
                        color: "steelblue",
                        yDomain: [75, 200],
                        yLabel: "Price per liter"
                    })
                }
            }

            function pricePerMile(mile, yearIndex) {
                pricePerLiter = parseFloat(result[yearIndex][2]) / 100

                price = parseFloat((parseFloat(mile) / mpl) * parseFloat(pricePerLiter)).toFixed(2)
                return price
            }

            function docalc() {
                let miles = milesInput.val();
                console.log("miles " + miles)
                if (miles === "") {
                    return undefined
                }

                price = pricePerMile(miles, 0)
                console.log("here!")

                $("#mylist").append("<li>Â£" + price + " to go " + miles + " miles in the van</li>");

                chartData = []
                min = 0
                max = 0
                result.forEach((r, i) => {
                    var parts = r[0].split("/");
                    var dt = new Date(parseInt(parts[2], 10),
                        parseInt(parts[1], 10) - 1,
                        parseInt(parts[0], 10));
                    let date = dt.toLocaleDateString('en-us', {
                        day: 'numeric'
                    })
                    let month = dt.toLocaleDateString('en-us', {
                        month: 'long'
                    })
                    let year = dt.toLocaleDateString('en-us', {
                        year: 'numeric'
                    })

                    if (date !== "Invalid Date") {
                        newPrice = pricePerMile(miles, i)

                        if (price < min || min === 0) {
                            min = newPrice
                        }

                        if (price > max || max === 0) {
                            max = newPrice
                        }
                        if (date !== "Invalid Date") {
                            chartData.push({
                                date: Date.parse(`${date} ${month} ${year}`),
                                price: newPrice
                            })
                        }
                    }
                })

                chart = LineChart(chartData, {
                    x: d => d.date,
                    y: d => d.price,
                    width: 1000,
                    height: 1000,
                    color: "steelblue",
                    yDomain: [min, max],
                    yLabel: "Price for " + miles + "miles"
                })
            }

            function LineChart(data, {
                x = ([x]) => x, // given d in data, returns the (temporal) x-value
                y = ([, y]) => y, // given d in data, returns the (quantitative) y-value
                defined, // for gaps in data
                curve = d3.curveLinear, // method of interpolation between points
                marginTop = 20, // top margin, in pixels
                marginRight = 30, // right margin, in pixels
                marginBottom = 30, // bottom margin, in pixels
                marginLeft = 40, // left margin, in pixels
                width = 640, // outer width, in pixels
                height = 400, // outer height, in pixels
                xType = d3.scaleUtc, // the x-scale type
                xDomain, // [xmin, xmax]
                xRange = [marginLeft, width - marginRight], // [left, right]
                yType = d3.scaleLinear, // the y-scale type
                yDomain, // [ymin, ymax]
                yRange = [height - marginBottom, marginTop], // [bottom, top]
                yFormat, // a format specifier string for the y-axis
                yLabel, // a label for the y-axis
                color = "currentColor", // stroke color of line
                strokeLinecap = "round", // stroke line cap of the line
                strokeLinejoin = "round", // stroke line join of the line
                strokeWidth = 2, // stroke width of line, in pixels
                strokeOpacity = 1, // stroke opacity of line
            } = {}) {
                // Compute values.
                const X = d3.map(data, x);
                const Y = d3.map(data, y);
                const I = d3.range(X.length);
                if (defined === undefined) defined = (d, i) => !isNaN(X[i]) && !isNaN(Y[i]);
                const D = d3.map(data, defined);

                // Compute default domains.
                if (xDomain === undefined) xDomain = d3.extent(X);
                if (yDomain === undefined) yDomain = [0, d3.max(Y)];

                // Construct scales and axes.
                const xScale = xType(xDomain, xRange);
                const yScale = yType(yDomain, yRange);
                const xAxis = d3.axisBottom(xScale).ticks(width / 80).tickSizeOuter(0);
                const yAxis = d3.axisLeft(yScale).ticks(height / 40, yFormat);

                // Construct a line generator.
                const line = d3.line()
                    .defined(i => D[i])
                    .curve(curve)
                    .x(i => xScale(X[i]))
                    .y(i => yScale(Y[i]));

                d3.select("#my_dataviz").select("svg").remove()

                const svg = d3.select("#my_dataviz").append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .attr("viewBox", [0, 0, width, height])
                    .attr("style", "max-width: 100%; height: auto; height: intrinsic;");

                svg.append("g")
                    .attr("transform", `translate(0,${height - marginBottom})`)
                    .call(xAxis);

                svg.append("g")
                    .attr("transform", `translate(${marginLeft},0)`)
                    .call(yAxis)
                    .call(g => g.select(".domain").remove())
                    .call(g => g.selectAll(".tick line").clone()
                        .attr("x2", width - marginLeft - marginRight)
                        .attr("stroke-opacity", 0.1))
                    .call(g => g.append("text")
                        .attr("x", -marginLeft)
                        .attr("y", 10)
                        .attr("fill", "currentColor")
                        .attr("text-anchor", "start")
                        .text(yLabel));

                svg.append("path")
                    .attr("fill", "none")
                    .attr("stroke", color)
                    .attr("stroke-width", strokeWidth)
                    .attr("stroke-linecap", strokeLinecap)
                    .attr("stroke-linejoin", strokeLinejoin)
                    .attr("stroke-opacity", strokeOpacity)
                    .attr("d", line(I));

                return svg.node();
            }
        });
    </script>
</head>
<body>

<label for="#distance-input">Distance (in miles)</label>
<input type="number" id="distance-input">
<br/>
<br/>
<ul id="mylist">
</ul>

<div id="my_dataviz"></div>

</body>
</html>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">The van build</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">The van build</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>The site for the bridgeborbarnvsky vanbuild.
WIP - check back for updates</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
